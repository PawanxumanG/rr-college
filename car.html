<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Dr. Driving Mobile Pro</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --safe-top: env(safe-area-inset-top, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 16px);
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #050505;
            font-family: 'Roboto', sans-serif;
            touch-action: none;
            user-select: none;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .font-orbitron { font-family: 'Orbitron', sans-serif; }

        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 500px;
            background: #000;
            overflow: hidden;
            box-shadow: 0 0 80px rgba(0,0,0,0.6);
        }

        #game-canvas {
            display: block;
            width: 100%;
            height: 100%;
            background: #0a0a0a;
        }

        .hidden { display: none !important; }

        .glass-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(12px);
            transition: 0.12s ease;
        }

        .glass-btn:active {
            transform: scale(0.94);
            background: rgba(255,255,255,0.15);
        }

        .steer-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
        }

        .pedal-btn {
            width: 70px;
            height: 130px;
            border-radius: 20px;
        }

        .pedal-label {
            writing-mode: vertical-rl;
            font-size: 10px;
            letter-spacing: 2px;
            font-weight: 700;
            opacity: 0.6;
        }

        .brake-btn { background: rgba(239,68,68,0.08); }
        .gas-btn { background: rgba(16,185,129,0.08); }
    </style>
</head>

<body>

<div id="game-container">
    <canvas id="game-canvas"></canvas>

    <!-- MENU -->
    <div id="menu-screen" class="absolute inset-0 bg-black/80 flex flex-col items-center justify-center text-center">
        <h1 class="text-5xl font-orbitron font-bold text-transparent bg-clip-text bg-gradient-to-br from-blue-400 to-emerald-400 italic">
            DR. DRIVING
        </h1>
        <p class="text-zinc-500 text-xs tracking-widest mt-1">PRO MOBILE</p>
        <button onclick="showMissionSelect()" class="mt-10 px-10 py-5 bg-blue-600 text-white rounded-2xl font-orbitron active:scale-95">
            START CAREER
        </button>
    </div>

    <!-- MISSION SELECT -->
    <div id="mission-screen" class="absolute inset-0 bg-black hidden flex-col items-center pt-16 px-6">
        <h2 class="text-white font-orbitron tracking-widest mb-8">MISSIONS</h2>
        <div id="mission-list" class="w-full max-w-sm space-y-4"></div>
        <button onclick="showMenu()" class="mt-auto mb-10 text-zinc-500 text-xs">Back</button>
    </div>

    <!-- RESULT -->
    <div id="result-screen" class="absolute inset-0 bg-black hidden flex-col items-center justify-center text-center">
        <h2 id="result-title" class="text-4xl font-orbitron mb-6"></h2>
        <p id="result-eval" class="text-zinc-400 italic mb-10"></p>
        <button onclick="restartMission()" class="mb-4 px-8 py-4 bg-blue-600 rounded-xl text-white">Retry</button>
        <button onclick="showMissionSelect()" class="px-8 py-4 bg-zinc-800 rounded-xl text-zinc-300">Exit</button>
    </div>

    <!-- CONTROLS -->
    <div id="controls" class="absolute bottom-0 w-full p-6 hidden">
        <div class="flex justify-between mb-4">
            <button class="steer-btn glass-btn" ontouchstart="input.left=true" ontouchend="input.left=false">←</button>
            <button class="steer-btn glass-btn" ontouchstart="input.right=true" ontouchend="input.right=false">→</button>
        </div>
        <div class="flex justify-between">
            <button class="pedal-btn glass-btn brake-btn" ontouchstart="input.brake=true" ontouchend="input.brake=false">
                <span class="pedal-label text-red-400">BRAKE</span>
            </button>
            <button class="pedal-btn glass-btn gas-btn" ontouchstart="input.gas=true" ontouchend="input.gas=false">
                <span class="pedal-label text-emerald-400">GAS</span>
            </button>
        </div>
    </div>
</div>

<script>
const canvas = document.getElementById("game-canvas");
const ctx = canvas.getContext("2d");

const LANE_WIDTH = 80;
const PLAYER_W = 38;
const PLAYER_H = 72;

const missions = [
  { title:"CITY DRIFT", dist:800 },
  { title:"HIGHWAY RUN", dist:3000 },
  { title:"PRO ENDURANCE", dist:8000 }
];

let player = { lane:1, x:0, y:0, speed:4 };
let traffic = [];
let input = { left:false, right:false, gas:false, brake:false };
let currentMission = null;
let playing = false;

function resize(){
  canvas.width = LANE_WIDTH * 3;
  canvas.height = window.innerHeight;
  player.y = canvas.height - 220;
}
resize();
window.onresize = resize;

function show(id){ document.getElementById(id).classList.remove("hidden"); }
function hide(id){ document.getElementById(id).classList.add("hidden"); }

function showMenu(){
  hide("mission-screen"); hide("result-screen"); hide("controls");
  show("menu-screen");
}

function showMissionSelect(){
  hide("menu-screen"); hide("result-screen");
  show("mission-screen");
  const list = document.getElementById("mission-list");
  list.innerHTML = "";
  missions.forEach(m=>{
    const d=document.createElement("div");
    d.className="glass-btn p-4 rounded-xl text-white";
    d.innerText=m.title+" • "+m.dist+"m";
    d.onclick=()=>startMission(m);
    list.appendChild(d);
  });
}

function startMission(m){
  currentMission=m;
  player.lane=1; player.speed=4;
  traffic=[];
  playing=true;
  hide("mission-screen"); hide("menu-screen");
  show("controls");
  loop();
}

function gameOver(success){
  playing=false;
  hide("controls");
  show("result-screen");
  document.getElementById("result-title").innerText = success?"MISSION PASS":"CRASH";
  document.getElementById("result-eval").innerText = success?"Clean driving!":"Avoid traffic!";
}

function loop(){
  if(!playing) return;
  update(); draw();
  requestAnimationFrame(loop);
}

function update(){
  if(input.left && player.lane>0) player.lane--;
  if(input.right && player.lane<2) player.lane++;
  if(input.gas) player.speed=Math.min(player.speed+0.1,18);
  if(input.brake) player.speed=Math.max(player.speed-0.3,0);

  player.x = player.lane*LANE_WIDTH + 21;

  if(Math.random()<0.02){
    traffic.push({lane:Math.floor(Math.random()*3), y:-100});
  }

  traffic.forEach(t=>t.y+=player.speed);
  traffic = traffic.filter(t=>t.y<canvas.height+100);

  traffic.forEach(t=>{
    if(Math.abs(player.x-(t.lane*LANE_WIDTH+21))<30 && Math.abs(player.y-t.y)<60){
      gameOver(false);
    }
  });
}

function draw(){
  ctx.fillStyle="#0a0a0a";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.strokeStyle="#222";
  ctx.setLineDash([40,60]);
  for(let i=1;i<3;i++){
    ctx.beginPath();
    ctx.moveTo(i*LANE_WIDTH,0);
    ctx.lineTo(i*LANE_WIDTH,canvas.height);
    ctx.stroke();
  }

  traffic.forEach(t=>{
    ctx.fillStyle="#ef4444";
    ctx.fillRect(t.lane*LANE_WIDTH+21,t.y,PLAYER_W,PLAYER_H);
  });

  ctx.fillStyle="#3b82f6";
  ctx.fillRect(player.x,player.y,PLAYER_W,PLAYER_H);
}

showMenu();
</script>

</body>
</html>